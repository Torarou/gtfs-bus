<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>formerApproachGuidance変換</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;margin:18px;background:#f7fafc;color:#111}
    textarea{width:100%;height:120px;padding:8px;font-family:monospace}
    button{padding:8px 12px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer;margin-top:10px}
    pre{background:#fff;padding:12px;border-radius:6px;overflow:auto}
    .small{font-size:0.9em;color:#555}
  </style>
</head>
<body>

<h2>formerApproachGuidance 変換</h2>
<p class="small">URL またはクエリ文字列を入力すると formerApproachGuidance をデコードし、A Bつ前 C と CSV の対応語を表示します。</p>

<textarea id="input" placeholder="ここに URL またはクエリ文字列を貼り付け"></textarea>
<br>
<button id="decodeBtn">抽出してデコード</button>

<h3>デコード結果（生）</h3>
<pre id="raw">—</pre>

<h3>分解 + CSV 対応表示</h3>
<div id="parsed">—</div>

<script>
// ----------------------------
// CSV を JS オブジェクトに格納
// ----------------------------
const carnoMap = {
  "1383":"西賀茂","1385":"西賀茂","1391":"西賀茂","1392":"西賀茂",
  "1395":"九条","1396":"九条","1397":"九条","1440":"梅津","1441":"梅津",
  "1443":"九条","1445":"梅津JR","1446":"九条","1447":"九条","1448":"九条",
  "1450":"九条","1453":"梅津","1454":"梅津","1455":"九条","1457":"九条",
  "1458":"梅津JR","1461":"梅津JR","1462":"九条","1463":"梅津JR","1464":"九条",
  "1466":"九条","1468":"洛西近鉄","1470":"洛西近鉄","1471":"洛西近鉄","1472":"洛西近鉄",
  "1475":"洛西近鉄","1476":"洛西近鉄","1482":"洛西近鉄","1489":"洛西近鉄","1490":"錦林京都",
  "1491":"洛西近鉄","1492":"洛西近鉄","1493":"洛西近鉄","1507":"九条","1508":"九条",
  "1509":"九条","1510":"梅津","1511":"梅津","1512":"梅津","1513":"錦林京都","1514":"錦林京都",
  "1515":"洛西近鉄","1517":"梅津JR","1518":"梅津JR","1519":"梅津JR","1520":"梅津JR","1521":"九条",
  "1522":"九条","1524":"洛西近鉄","1525":"洛西近鉄","1526":"洛西近鉄","1527":"九条","1528":"九条",
  "1529":"梅津","1530":"九条","1531":"九条","1532":"九条","1533":"九条","1534":"九条","1544":"梅津",
  "1545":"梅津","1547":"九条","1548":"梅津","1550":"九条","1551":"九条","1552":"九条","1553":"九条",
  "1554":"西賀茂","1556":"西賀茂","1557":"西賀茂","1562":"洛西近鉄","1683":"梅津","1684":"梅津",
  "1685":"梅津","1686":"梅津","1687":"錦林京都","1688":"錦林京都","1691":"梅津","1692":"梅津","1693":"梅津JR",
  "1694":"錦林京都","1695":"錦林京都","1696":"錦林京都","1698":"梅津","1699":"梅津","1700":"梅津",
  "1701":"梅津JR","1703":"九条","1704":"九条","1705":"九条","1706":"九条","1707":"梅津JR","1709":"洛西近鉄",
  "1710":"梅津JR","1711":"洛西近鉄","1712":"洛西近鉄","1713":"九条","1714":"九条","1715":"九条","1716":"九条",
  "1717":"錦林京都","1718":"錦林京都","1719":"梅津","1720":"九条","1721":"九条","1722":"九条","1728":"梅津",
  "1729":"梅津","1730":"九条","1731":"九条","1732":"九条","1733":"九条","1734":"九条","1744":"九条",
  "1745":"九条","1746":"洛西近鉄","1747":"洛西近鉄","1748":"洛西近鉄","1753":"錦林京都","1754":"錦林京都",
  "1755":"九条","1756":"九条","1757":"九条","1759":"九条","1760":"九条","1761":"九条","1762":"洛西近鉄","1768":"西賀茂","1769":"西賀茂","1770":"西賀茂","1771":"横大路阪急","1772":"横大路阪急","1773":"西賀茂","1774":"西賀茂","1775":"西賀茂","1776":"西賀茂","1777":"横大路阪急","1778":"横大路阪急","1779":"横大路阪急","1783":"西賀茂","1784":"西賀茂","1785":"西賀茂","1788":"烏丸","1789":"烏丸","1790":"烏丸","1791":"烏丸","1795":"烏丸","1796":"烏丸","1797":"烏丸","1798":"烏丸","1969":"烏丸","1970":"烏丸","1971":"烏丸","1972":"烏丸","1974":"烏丸","1975":"烏丸","1976":"烏丸","1977":"烏丸","1999":"梅津","2001":"梅津","2002":"梅津","2003":"梅津","2004":"九条","2005":"九条","2008":"梅津","2009":"梅津","2010":"九条","2011":"九条","2012":"九条","2013":"九条","2014":"九条","2015":"九条","2016":"九条","2017":"錦林京都","2018":"九条","2027":"九条","2028":"九条","2029":"九条","2030":"洛西近鉄","2031":"洛西近鉄","2032":"洛西近鉄","2033":"洛西近鉄","2034":"洛西近鉄","2040":"九条","2041":"九条","2043":"洛西近鉄","2045":"洛西近鉄","2046":"洛西近鉄","2047":"洛西近鉄","2048":"洛西近鉄","2050":"洛西近鉄","2051":"洛西近鉄","2053":"西賀茂","2054":"西賀茂","2055":"西賀茂","2056":"西賀茂","2061":"西賀茂","2062":"西賀茂","2063":"西賀茂","2064":"西賀茂","2068":"西賀茂","2069":"西賀茂","2070":"西賀茂","2076":"西賀茂","2077":"西賀茂","2078":"横大路阪急","2079":"横大路阪急","2081":"西賀茂","2082":"西賀茂",
  "2083":"横大路阪急","2084":"横大路阪急","2085":"西賀茂","2086":"西賀茂","2087":"西賀茂","2088":"西賀茂","2089":"横大路阪急","2090":"横大路阪急","2093":"西賀茂","2272":"梅津JR","2273":"梅津JR","2414":"梅津JR","2415":"梅津JR","2526":"梅津JR","2527":"梅津JR","2528":"梅津JR","2529":"梅津JR","2530":"梅津JR","2531":"梅津JR","2532":"梅津JR","2648":"洛西近鉄","2650":"洛西近鉄","2651":"洛西近鉄","2652":"梅津JR","2653":"梅津JR","2654":"梅津JR","2655":"梅津JR","2658":"梅津JR","2659":"洛西近鉄","2660":"洛西近鉄","2663":"洛西近鉄","2664":"洛西近鉄","2665":"洛西近鉄","2666":"洛西近鉄","2667":"梅津JR","2668":"洛西近鉄","2669":"洛西近鉄","2670":"洛西近鉄","2671":"洛西近鉄","2672":"洛西近鉄","2678":"横大路阪急","2679":"横大路阪急","2680":"横大路阪急","2681":"横大路阪急","2683":"横大路阪急","2685":"横大路阪急","2686":"横大路阪急","2687":"横大路阪急","2816":"梅津","2817":"梅津","2818":"九条","2819":"九条","2820":"九条","2821":"九条","2822":"梅津JR","2823":"梅津JR","2824":"錦林京都","2825":"錦林京都","2829":"西賀茂","2830":"西賀茂","2831":"西賀茂","2832":"九条","2833":"九条","2834":"九条","2836":"梅津JR","2837":"梅津JR","2838":"九条","2839":"九条","2840":"九条","2845":"西賀茂","2846":"西賀茂","2847":"九条","2848":"九条","2850":"西賀茂","2851":"西賀茂","2852":"梅津","2853":"梅津","2865":"梅津",
  "2866":"梅津","2867":"梅津","2868":"梅津","2871":"梅津","2872":"梅津","2873":"梅津","2874":"梅津","2973":"洛西近鉄","2974":"洛西近鉄","2975":"洛西近鉄","2976":"洛西近鉄","2980":"西賀茂","2981":"西賀茂","2982":"横大路阪急","2983":"横大路阪急","2984":"錦林京都","2985":"錦林京都","2989":"西賀茂","2990":"西賀茂","2991":"横大路阪急","2992":"横大路阪急","2994":"西賀茂","2995":"西賀茂","2996":"西賀茂","2997":"梅津","2998":"梅津","2999":"梅津",
  "3010":"梅津","3011":"梅津","3012":"九条","3013":"九条","3016":"九条","3017":"九条","3018":"烏丸","3019":"烏丸","3027":"梅津","3028":"烏丸","3029":"烏丸","3030":"烏丸","3040":"梅津JR","3041":"梅津JR","3043":"洛西近鉄","3044":"洛西近鉄","3051":"九条","3052":"九条","3053":"洛西近鉄","3054":"洛西近鉄","3124":"横大路MK","3128":"横大路MK","3129":"横大路MK","3130":"横大路MK","3165":"西賀茂","3166":"西賀茂","3167":"梅津","3168":"梅津","3169":"烏丸","3170":"烏丸","3175":"横大路阪急","3176":"横大路阪急","3177":"横大路阪急","3178":"九条","3179":"横大路阪急","3181":"横大路阪急","3182":"横大路阪急","3183":"横大路阪急","3184":"錦林京都","3185":"洛西近鉄","3186":"洛西近鉄","3188":"西賀茂","3189":"西賀茂","3190":"西賀茂","3191":"九条","3192":"横大路阪急","3193":"横大路阪急","3194":"梅津","3195":"西賀茂","3196":"烏丸","3197":"烏丸","3202":"横大路阪急","3203":"横大路阪急","3204":"九条","3205":"横大路阪急","3206":"横大路阪急","3208":"梅津JR","3209":"錦林京都","3210":"錦林京都","3211":"錦林京都","3213":"九条","3214":"九条","3215":"九条","3216":"烏丸","3217":"烏丸","3218":"烏丸","3219":"烏丸","3329":"西賀茂","3330":"西賀茂","3331":"横大路阪急","3332":"九条","3334":"九条","3335":"西賀茂","3336":"西賀茂","3337":"西賀茂","3338":"梅津","3339":"九条","3346":"洛西近鉄","3347":"洛西近鉄","3348":"錦林京都","3350":"九条","3351":"九条","3355":"西賀茂","3356":"梅津JR","3357":"横大路阪急","3358":"横大路阪急","3359":"横大路阪急","3362":"西賀茂","3363":"西賀茂","3364":"横大路阪急","3365":"横大路阪急",
  "3368":"錦林京都","3369":"錦林京都","3370":"九条","3371":"九条","3372":"洛西近鉄","3378":"烏丸","3379":"烏丸","3380":"烏丸","3381":"烏丸","3382":"烏丸","3383":"烏丸","3384":"横大路阪急","3385":"横大路阪急","3386":"烏丸","3387":"烏丸","3390":"九条","3391":"洛西近鉄","3392":"洛西近鉄","3393":"洛西近鉄","3485":"横大路阪急","3486":"西賀茂","3487":"梅津","3488":"西賀茂","3489":"九条","3490":"九条","3495":"横大路阪急","3496":"横大路阪急","3497":"横大路阪急","3498":"横大路阪急","3503":"梅津","3504":"錦林京都","3505":"錦林京都","3506":"九条","3507":"梅津JR","3508":"梅津","3509":"錦林京都","3510":"横大路阪急","3511":"横大路阪急","3512":"烏丸","3513":"烏丸","3514":"烏丸","3518":"西賀茂","3519":"西賀茂","3520":"九条","3521":"錦林京都","3525":"烏丸","3526":"烏丸","3527":"烏丸","3528":"九条","3529":"九条","3530":"九条","3531":"九条","3532":"烏丸","3533":"烏丸","3534":"烏丸","3535":"西賀茂","3536":"西賀茂","3537":"梅津","3538":"錦林京都","3539":"錦林京都","3540":"九条","3626":"梅津","3627":"梅津","3628":"横大路阪急","3629":"横大路阪急","3630":"洛西近鉄","3631":"洛西近鉄","3632":"梅津","3633":"梅津","3634":"錦林京都","3635":"錦林京都","3636":"洛西近鉄","3637":"洛西近鉄","3638":"西賀茂","3639":"西賀茂","3640":"梅津","3641":"梅津","3643":"九条","3644":"九条","3647":"西賀茂","3648":"西賀茂","3650":"梅津","3651":"梅津","3652":"九条","3653":"九条","3659":"梅津","3660":"梅津","3661":"梅津JR","3662":"九条","3663":"九条","3664":"九条","3672":"烏丸","3673":"烏丸","3674":"烏丸","3675":"西賀茂","3676":"西賀茂","3677":"九条","3678":"梅津","3679":"錦林京都","3681":"九条","3682":"梅津JR","3683":"梅津JR","3684":"烏丸","3685":"烏丸","3686":"烏丸","3781":"西賀茂","3782":"西賀茂","3783":"梅津","3784":"梅津JR","3786":"横大路阪急","3787":"横大路阪急","3788":"横大路阪急","3789":"九条","3790":"烏丸","3795":"横大路阪急","3796":"横大路阪急","3797":"洛西近鉄","3798":"西賀茂","3799":"西賀茂","3800":"梅津JR","3801":"九条","3802":"烏丸","3808":"横大路MK","3809":"横大路MK",
  "3810":"洛西近鉄","3811":"梅津","3812":"梅津","3813":"九条","3814":"烏丸","3816":"横大路阪急","3817":"横大路阪急","3818":"梅津","3819":"梅津","3820":"九条","3821":"九条","3822":"九条","3823":"九条","3824":"烏丸","3825":"烏丸","3826":"烏丸","3827":"錦林京都","3829":"錦林京都","3830":"錦林京都","3831":"九条","3832":"錦林京都","3833":"横大路阪急","3834":"横大路MK","3835":"洛西近鉄","3836":"横大路MK","3837":"西賀茂","3838":"梅津","3839":"九条","3910":"西賀茂","3911":"梅津","3912":"梅津JR","3913":"九条","3914":"九条","3915":"梅津","3916":"烏丸","3917":"横大路阪急","3918":"横大路MK","3919":"梅津","3920":"梅津JR","3921":"九条","3922":"九条","3923":"横大路MK","3924":"横大路MK","3925":"西賀茂","3926":"西賀茂","3927":"梅津","3928":"梅津","3929":"横大路MK","3930":"横大路MK","3931":"九条","3932":"九条","3933":"烏丸","3934":"烏丸","3935":"洛西近鉄","3936":"洛西近鉄","3938":"西賀茂","3939":"西賀茂","3940":"梅津JR","3941":"梅津","3943":"横大路阪急","3947":"錦林京都","3948":"九条","3950":"横大路阪急","3951":"横大路MK","3954":"西賀茂","3955":"西賀茂","3956":"錦林京都","3957":"横大路阪急","3958":"横大路阪急","3961":"梅津","3962":"九条","3963":"梅津","3964":"洛西近鉄","3965":"洛西近鉄",
  "3966":"九条","3967":"横大路阪急","3970":"烏丸","3971":"烏丸","3972":"烏丸","3974":"梅津","3975":"梅津","3976":"洛西近鉄","3977":"洛西近鉄","3984":"烏丸","3985":"烏丸","3986":"烏丸","4014":"西賀茂","4015":"西賀茂","4016":"梅津","4017":"横大路MK","4018":"烏丸","4019":"九条","4020":"九条","4021":"梅津","4022":"横大路阪急","4023":"横大路MK","4024":"梅津","4025":"梅津JR","4026":"九条","4027":"横大路阪急","4028":"横大路阪急","4029":"梅津JR","4030":"洛西近鉄","4031":"洛西近鉄","4032":"梅津","4033":"横大路阪急","4034":"梅津","4035":"烏丸","4036":"横大路MK","4038":"烏丸","4039":"烏丸","4040":"烏丸","4041":"梅津","4043":"横大路阪急","4047":"九条","4048":"九条","4050":"洛西近鉄","4051":"横大路阪急","4052":"横大路阪急","4053":"西賀茂","4054":"錦林京都","4055":"烏丸","4056":"烏丸","4059":"西賀茂","4060":"西賀茂","4061":"九条","4062":"九条","4063":"錦林京都","4108":"九条","4109":"九条","4110":"梅津","4111":"梅津","4112":"横大路阪急","4113":"西賀茂","4114":"烏丸","4115":"烏丸","4116":"横大路阪急","4117":"横大路MK","4122":"梅津","4123":"梅津","4124":"九条","4125":"横大路阪急","4126":"横大路MK","4127":"西賀茂","4128":"西賀茂","4129":"洛西近鉄","4130":"横大路阪急","4131":"横大路MK","4132":"洛西近鉄","4133":"梅津","4134":"梅津JR","4135":"横大路阪急","4136":"洛西近鉄","4137":"洛西近鉄","4138":"烏丸","4139":"烏丸","4140":"横大路阪急","4141":"洛西近鉄","4143":"洛西近鉄","4146":"西賀茂","4147":"梅津","4148":"梅津JR","4150":"九条","4151":"九条","4153":"梅津","4154":"錦林京都","4155":"九条","4156":"九条","4157":"烏丸","4195":"横大路阪急","4196":"横大路阪急","4197":"洛西近鉄","4198":"洛西近鉄","4199":"烏丸","4200":"烏丸","4201":"西賀茂","4202":"西賀茂","4203":"梅津","4204":"梅津","4205":"洛西近鉄","4206":"洛西近鉄","4207":"横大路阪急","4208":"横大路阪急","4211":"梅津","4212":"梅津","4213":"烏丸","4214":"烏丸","4216":"横大路阪急","4217":"洛西近鉄","4218":"横大路阪急","4219":"洛西近鉄","4220":"横大路阪急","4221":"横大路阪急","4222":"梅津","4223":"梅津","4224":"九条","4225":"九条","4226":"横大路阪急","4227":"横大路阪急","4228":"西賀茂","4229":"西賀茂","4230":"九条","4231":"九条","4232":"梅津","4233":"梅津JR","4234":"錦林京都","4235":"洛西近鉄","4237":"九条","4238":"九条","4241":"九条","4243":"九条","4321":"梅津","4322":"梅津","4323":"九条","4324":"洛西近鉄","4325":"梅津","4326":"九条","4327":"梅津","4328":"梅津","4329":"九条","4354":"洛西近鉄","4355":"洛西近鉄","4356":"西賀茂","4357":"西賀茂","4358":"西賀茂","4359":"梅津","4360":"梅津JR","4361":"九条","4363":"梅津","4364":"九条","4365":"九条","4366":"烏丸","4367":"横大路MK","4368":"梅津JR","4369":"烏丸","4370":"洛西近鉄","4371":"洛西近鉄","4375":"錦林京都","4376":"錦林京都","4377":"九条","4378":"九条","4380":"横大路阪急","4381":"横大路阪急","4382":"九条","4383":"九条","4384":"梅津","4385":"九条","4386":"洛西近鉄","4387":"洛西近鉄","4388":"西賀茂","4389":"梅津JR","4390":"九条","4391":"九条","4392":"九条","4393":"九条","4394":"烏丸","4395":"洛西近鉄","4396":"梅津","4397":"横大路阪急","4398":"九条","4399":"烏丸","4401":"西賀茂","4402":"西賀茂","4403":"九条","4404":"洛西近鉄","4405":"梅津JR","4406":"九条","4407":"九条","4408":"洛西近鉄","4409":"西賀茂","4410":"梅津","4411":"烏丸","4412":"梅津JR","4413":"洛西近鉄","4414":"洛西近鉄","4415":"九条","4416":"九条"
  
};
// ⚠ CSV の全データをここに追加することで、fetch 不要になります

// ----------------------------
// クエリ抽出
// ----------------------------
function extractQueryString(input){
  if(!input) return '';
  const qIndex = input.indexOf('?');
  return qIndex >= 0 ? input.substring(qIndex + 1) : input;
}

function getParamValue(queryString, key){
  try{
    return new URLSearchParams(queryString).get(key);
  }catch(e){ return null; }
}

// ----------------------------
// formerApproachGuidance デコード
// ----------------------------
function safeDecode(s){
  if(s==null) return null;
  try{ return decodeURIComponent(s.replace(/\+/g,' ')); }
  catch(e){ return s; }
}

function parseFormerApproachGuidance(decoded){
  if(!decoded) return [];
  const tokens = decoded.split(/[@$]+/).map(t=>t.trim()).filter(Boolean);
  return tokens.map(token => ({ raw: token, parts: token.split(/[:;]/).map(p=>p.trim()) }));
}

// ----------------------------
// 表示
// ----------------------------
function render(results) {
  const out = document.getElementById('parsed');
  out.innerHTML = '';

  results.forEach(r => {
    if (r.parts.length >= 3) {
      const [A,B,C] = r.parts;
      const label = carnoMap[A] ?? "";
      out.innerHTML += `${A} ${B}つ前 ${C}${label ? ' ' + label : ''}<br>`;
    } else {
      out.innerHTML += r.raw + '<br>';
    }
  });
}

// ----------------------------
// ボタン動作
// ----------------------------
document.getElementById('decodeBtn').addEventListener('click', ()=>{
  const input = document.getElementById('input').value.trim();
  const qs = extractQueryString(input);
  const rawVal = getParamValue(qs,'formerApproachGuidance');

  if(rawVal===null){
    document.getElementById('raw').textContent = 'formerApproachGuidance パラメータが見つかりません。';
    document.getElementById('parsed').innerHTML = '<div class="small">—</div>';
    return;
  }

  const decoded = safeDecode(rawVal);
  document.getElementById('raw').textContent = decoded;
  const rows = parseFormerApproachGuidance(decoded);
  render(rows);
});
</script>

</body>
</html>
